{% extends 'base.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}

{% block body %}
    <h1>Paso 1: Registro</h1>
    <hr>

    {# BLOQUE DE ALERTAS DE ERROR #}
    {% if not formulario.vars.valid %}
        <div style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong>¡Hay pedos en el formulario!</strong>
            <ul style="margin-top: 5px;">
                {% for child in formulario.children %}
                    {% for error in child.vars.errors %}
                        <li><strong>{{ child.vars.label }}:</strong> {{ error.message }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    {# ALERTAS DE FLASH PARA EL CAPTCHA #}
    {% for message in app.flashes('error') %}
        <div style="color: white; background: #dc3545; padding: 10px; margin-bottom: 15px; border-radius: 4px;">
            {{ message }}
        </div>
    {% endfor %}

    <div style="max-width: 500px; padding: 20px; border: 1px solid #ddd; background: #fff; border-radius: 8px;">
        {{ form_start(formulario) }}
        <div style="margin-bottom: 15px;">
            {{ form_row(formulario.nombre, {'attr': {'style': 'width:100%; padding: 8px;'}}) }}
        </div>
        <div style="margin-bottom: 15px;">
            {{ form_row(formulario.email, {'attr': {'style': 'width:100%; padding: 8px;'}}) }}
        </div>
        <div style="margin-bottom: 15px;">
            {{ form_row(formulario.telefono, {'attr': {'style': 'width:100%; padding: 8px;'}}) }}
        </div>
        <div style="margin-bottom: 15px;">
            {{ form_row(formulario.password.first, {'attr': {'style': 'width:100%; padding: 8px;'}}) }}
        </div>
        <div style="margin-bottom: 15px;">
            {{ form_row(formulario.password.second, {'attr': {'style': 'width:100%; padding: 8px;'}}) }}
        </div>

        <div style="margin-bottom: 20px;">
            <label>Verificación de seguridad:</label>
            <div style="margin-top: 10px;">
                {# RECAPTCHA INTEGRADO #}
                <div class="g-recaptcha" data-sitekey="6LdJQlcsAAAAAHng2XiAGWHbFeaJi_d1ggsLHlND"></div>
            </div>
        </div>

        <button type="submit" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 4px;">
            Validar y Continuar
        </button>
        {{ form_end(formulario, {'render_rest': false}) }}
    </div>
{% endblock %}
